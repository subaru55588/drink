<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è‰¾ç‘ªçš„é£²æ–™æ—¥è¨˜</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#F2F0E9">
  
  <!-- è¼‰å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- è¼‰å…¥ React å’Œ ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- è¼‰å…¥ Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- è¼‰å…¥ Icon (Lucide) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    * { -webkit-tap-highlight-color: transparent; }
    html, body { 
      height: 100%; 
      overscroll-behavior-y: none;
      background-color: #F2F0E9;
      /* æ–°å¢ï¼šå¯æ„›çš„é»é»èƒŒæ™¯åº•ç´‹ */
      background-image: radial-gradient(#D6C0B5 0.8px, transparent 0.8px);
      background-size: 16px 16px;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    
    /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* å‹•ç•« */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

    /* æ–°å¢ï¼šè¼•å¾®è·³å‹•å‹•ç•« (çµ¦ FAB ä½¿ç”¨) */
    @keyframes bounce-slight {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }
    .animate-bounce-slight { animation: bounce-slight 2s infinite ease-in-out; }
    
    /* æ‰‹å¯«å­—é«” fallback */
    .font-hand { font-family: "Comic Sans MS", "Chalkboard SE", "Segoe UI Emoji", sans-serif; }
  </style>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            m: {
              bg: '#F2F0E9',       // ç´™å¼µç™½
              card: '#FCFAF7',     // å¡ç‰‡ç™½
              primary: '#8C9A8E',  // ç°ç¶  (ä¸»è‰²)
              secondary: '#B5A89E',// æš–ç° (æ¬¡è¦)
              accent: '#D6C0B5',   // ä¹¾ç‡¥ç«ç‘°ç²‰ (é»ç¶´)
              text: '#5E5C58',     // æ·±ç°å­—
              subtext: '#94918C',  // æ·ºç°å­—
              line: '#E6E2DC',     // åˆ†éš”ç·š
              hot: '#E09F8F',      // ç†±é£²è‰²
              ice: '#A6BCC4',      // å†·é£²è‰²
            }
          },
          boxShadow: {
            'soft': '0 4px 20px -2px rgba(94, 92, 88, 0.05)',
            'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.02)',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-m-bg text-m-text">
  <div id="root" class="h-full flex flex-col max-w-md mx-auto bg-m-bg/95 backdrop-blur-sm shadow-2xl overflow-hidden relative"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { Cup, Calendar, BarChart3, Plus, Trash2, X, ChevronLeft, ChevronRight, Droplets, Thermometer, Coffee } = lucide;

    // --- å…¨åŸŸè®Šæ•¸èˆ‡è¼”åŠ©å‡½æ•¸ ---
    const ICE_OPTIONS = ['æ­£å¸¸', 'å°‘å†°', 'å¾®å†°', 'å»å†°', 'å¸¸æº«', 'æº«', 'ç†±'];
    const SUGAR_OPTIONS = ['å…¨ç³–', 'å°‘ç³–', 'åŠç³–', 'å¾®ç³–', 'ä¸€åˆ†ç³–', 'ç„¡ç³–'];

    const formatDateKey = (date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    
    const getDaysInMonth = (date) => {
      const year = date.getFullYear();
      const month = date.getMonth();
      return {
        days: new Date(year, month + 1, 0).getDate(),
        firstDay: new Date(year, month, 1).getDay()
      };
    };

    const calculateStats = (records) => {
      let cups = 0, cost = 0, shops = {}, ices = {}, sugars = {};
      Object.values(records).forEach(dayList => {
        dayList.forEach(r => {
          cups++;
          cost += r.price;
          shops[r.shop] = (shops[r.shop] || 0) + 1;
          ices[r.ice] = (ices[r.ice] || 0) + 1;
          sugars[r.sugar] = (sugars[r.sugar] || 0) + 1;
        });
      });
      const topShop = Object.entries(shops).sort((a,b) => b[1]-a[1])[0];
      return { cups, cost, topShop, ices, sugars };
    };

    // --- åœ–ç¤ºå…ƒä»¶ ---
    const Icons = {
      Cup: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="8"/><line x1="10" x2="10" y1="2" y2="8"/><line x1="14" x2="14" y1="2" y2="8"/></svg>,
      Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
      Stats: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>,
      Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>, // åŠ ç²— Plus icon
      Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
      Left: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
      Right: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
    };

    // --- å­å…ƒä»¶ (æå–è‡³ App å¤–éƒ¨) ---
    
    const MainHeader = () => (
      <div className="pt-8 pb-2 flex flex-col items-center justify-center bg-m-bg/0 animate-fade-in relative z-10">
        <h1 className="text-xl font-bold text-m-text tracking-widest flex items-center gap-2 font-hand">
          <span className="text-2xl animate-bounce" style={{animationDuration: '3s'}}>âœ¨</span> 
          <span className="relative z-10 px-1">
            è‰¾ç‘ªçš„é£²æ–™æ—¥è¨˜
            <span className="absolute bottom-1 left-0 w-full h-3 bg-m-primary/30 -z-10 -rotate-2 rounded-full transform scale-105"></span>
          </span>
          <span className="text-2xl animate-bounce" style={{animationDuration: '3s', animationDelay: '0.5s'}}>ğŸ§¸</span>
        </h1>
        <p className="text-[10px] text-m-secondary tracking-[0.3em] mt-2 uppercase font-medium">My Boba Daily</p>
      </div>
    );

    const CalendarHeader = ({ currentDate, changeMonth, records }) => {
      const monthTotal = useMemo(() => {
        let total = 0;
        const prefix = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
        Object.keys(records).forEach(key => {
          if (key.startsWith(prefix)) {
            records[key].forEach(r => total += r.price);
          }
        });
        return total;
      }, [currentDate, records]);

      return (
        <div className="flex justify-between items-center px-6 py-4 bg-m-bg/0 relative z-10">
          <button onClick={() => changeMonth(-1)} className="p-2 rounded-full hover:bg-white/50 text-m-secondary transition-colors hover:scale-110 active:scale-90"><Icons.Left/></button>
          <div className="flex flex-col items-center">
            <div className="flex items-center gap-2">
              <span className="text-lg font-bold text-m-text tracking-widest font-serif">
                {currentDate.toLocaleString('default', { month: 'long' })}
              </span>
              <span className="text-xs font-bold text-m-primary bg-white/80 px-2 py-0.5 rounded-full border border-m-primary/20 shadow-sm flex items-center gap-1 backdrop-blur-sm">
                <span className="text-[10px] text-m-secondary font-normal uppercase">Spent</span>
                ${monthTotal}
              </span>
            </div>
            <span className="text-[10px] text-m-subtext tracking-widest">{currentDate.getFullYear()}</span>
          </div>
          <button onClick={() => changeMonth(1)} className="p-2 rounded-full hover:bg-white/50 text-m-secondary transition-colors hover:scale-110 active:scale-90"><Icons.Right/></button>
        </div>
      );
    };

    const CalendarGrid = ({ currentDate, selectedDateKey, setSelectedDateKey, setShowAddForm, records }) => {
      const { days, firstDay } = getDaysInMonth(currentDate);
      const blanks = Array(firstDay).fill(null);
      const dayArray = Array.from({ length: days }, (_, i) => i + 1);
      const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

      return (
        <div className="px-4 pb-4 border-b border-m-line/50 relative z-10">
          <div className="grid grid-cols-7 mb-2">
            {weekDays.map(d => <div key={d} className="text-center text-[10px] font-bold text-m-secondary uppercase tracking-wider py-2">{d}</div>)}
          </div>
          <div className="grid grid-cols-7 gap-y-2">
            {blanks.map((_, i) => <div key={`blank-${i}`} />)}
            {dayArray.map(day => {
              const dateKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
              const isSelected = selectedDateKey === dateKey;
              const isToday = formatDateKey(new Date()) === dateKey;
              const hasRecord = records[dateKey]?.length > 0;
              const recordCount = records[dateKey]?.length || 0;

              return (
                <div key={day} className="flex flex-col items-center justify-center relative h-12">
                  <button 
                    onClick={() => { setSelectedDateKey(dateKey); setShowAddForm(false); }}
                    className={`
                      w-9 h-9 flex items-center justify-center rounded-full text-sm font-medium transition-all duration-300 relative z-10
                      hover:scale-110 active:scale-90 /* å¢åŠ ä¿çš®çš„é»æ“Šç¸®æ”¾æ•ˆæœ */
                      ${isSelected ? 'bg-m-primary text-white shadow-lg shadow-m-primary/30 scale-105' : 
                        isToday ? 'text-m-primary font-bold border border-m-primary/30 bg-white/50' : 'text-m-text hover:bg-white/80'}
                    `}
                  >
                    {day}
                  </button>
                  <div className="flex gap-0.5 mt-1 h-1.5">
                    {hasRecord && Array.from({length: recordCount}).map((_, i) => (
                      <div key={i} className={`w-1.5 h-1.5 rounded-full ${isSelected ? 'bg-m-primary/30' : 'bg-m-accent'}`}></div>
                    ))}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const RecordList = ({ records, selectedDateKey, handleDelete, setShowAddForm }) => {
      const dayRecords = records[selectedDateKey] || [];
      
      return (
        <div className="flex-1 overflow-y-auto bg-white/40 relative backdrop-blur-sm">
          <div className="p-6 pb-24">
            <div className="flex justify-between items-end mb-4">
              <div>
                <h3 className="text-sm font-bold text-m-subtext uppercase tracking-wider mb-1 flex items-center gap-1">ğŸ“… Selected Date</h3>
                <div className="text-2xl font-serif text-m-text">
                  {selectedDateKey ? new Date(selectedDateKey).getDate() : '--'} 
                  <span className="text-base ml-2 font-normal text-m-subtext">
                    {selectedDateKey ? new Date(selectedDateKey).toLocaleString('default', { month: 'short' }) : ''}
                  </span>
                </div>
              </div>
              <div className="text-xs text-m-subtext bg-white/50 px-2 py-1 rounded-full">
                {dayRecords.length} Drinks ğŸ¥¤
              </div>
            </div>

            {dayRecords.length > 0 ? (
              <div className="space-y-3">
                {dayRecords.map((r, i) => (
                  <div key={r.id} className="bg-white/90 rounded-2xl p-4 shadow-soft flex justify-between items-center group animate-fade-in border border-m-line/30" style={{animationDelay: `${i*0.1}s`}}>
                    <div className="flex items-center gap-4">
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center shadow-sm ${['ç†±', 'æº«'].includes(r.ice) ? 'bg-m-hot/20 text-m-hot' : 'bg-m-ice/20 text-m-ice'}`}>
                        <Icons.Cup />
                      </div>
                      <div>
                        <div className="font-bold text-m-text text-sm">{r.item}</div>
                        <div className="text-xs text-m-subtext mt-0.5 flex items-center gap-1">ğŸª {r.shop}</div>
                      </div>
                    </div>
                    <div className="flex flex-col items-end gap-1">
                      <span className="font-bold text-m-primary">${r.price}</span>
                      <div className="flex gap-1">
                        <span className="text-[10px] px-1.5 py-0.5 bg-m-bg rounded text-m-subtext">{r.ice}</span>
                        <span className="text-[10px] px-1.5 py-0.5 bg-m-bg rounded text-m-subtext">{r.sugar}</span>
                      </div>
                      <button onClick={() => handleDelete(r.id)} className="text-red-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity absolute right-2 top-2 hover:scale-110 active:scale-90">
                         <Icons.Trash />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              // æ›´æ–°ï¼šæ›´å¯æ„›æ´»æ½‘çš„ç©ºç‹€æ…‹
              <div className="flex flex-col items-center justify-center py-12 text-m-secondary/70 space-y-4">
                <div className="text-6xl animate-bounce scale-110" style={{animationDuration: '2s'}}>ğŸ§‹</div>
                <p className="text-sm font-medium tracking-wider">ä»Šå¤©é‚„æ²’å–é£²æ–™è€¶ï½</p>
                <p className="text-xs bg-white/50 px-3 py-1 rounded-full">å¿«å»è²·ä¸€æ¯ä¾†ç´€éŒ„å§ï¼âœ¨</p>
              </div>
            )}
          </div>

          <button 
            onClick={() => setShowAddForm(true)}
            className="absolute bottom-6 right-6 w-14 h-14 bg-m-primary text-white rounded-full shadow-lg shadow-m-primary/40 flex items-center justify-center hover:scale-110 active:scale-90 transition-all z-20 animate-bounce-slight"
          >
            <Icons.Plus />
          </button>
        </div>
      );
    };

    const AddForm = ({ showAddForm, setShowAddForm, handleAddRecord, formData, setFormData }) => {
      if (!showAddForm) return null;
      return (
        <div className="absolute inset-0 z-50 flex flex-col justify-end bg-black/20 backdrop-blur-[2px]">
          <div className="bg-m-card rounded-t-[32px] p-6 shadow-2xl animate-fade-in border-t border-white/50">
            <div className="flex justify-between items-center mb-6">
              <h3 className="font-bold text-m-text text-lg flex items-center gap-2">âœï¸ æ–°å¢ç´€éŒ„</h3>
              <button onClick={() => setShowAddForm(false)} className="p-2 rounded-full bg-m-bg text-m-text hover:bg-m-line/50 transition-colors hover:scale-110 active:scale-90"><Icons.X size={20} /></button>
            </div>
            
            <form onSubmit={handleAddRecord} className="space-y-5">
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-1">
                  <label className="text-xs font-bold text-m-subtext uppercase ml-1">ğŸª Shop</label>
                  {/* æ›´æ–°ï¼šæ‰‹ç¹ªé¢¨è™›ç·šé‚Šæ¡† */}
                  <input autoFocus className="w-full bg-m-bg/50 border-2 border-dashed border-m-line/70 rounded-xl p-3 text-sm focus:border-m-primary focus:ring-0 placeholder-m-secondary/50 transition-all" placeholder="åº—å" value={formData.shop} onChange={e=>setFormData({...formData, shop: e.target.value})} required />
                </div>
                <div className="space-y-1">
                  <label className="text-xs font-bold text-m-subtext uppercase ml-1">ğŸ¥¤ Drink</label>
                  <input className="w-full bg-m-bg/50 border-2 border-dashed border-m-line/70 rounded-xl p-3 text-sm focus:border-m-primary focus:ring-0 placeholder-m-secondary/50 transition-all" placeholder="å“é …" value={formData.item} onChange={e=>setFormData({...formData, item: e.target.value})} required />
                </div>
              </div>

              <div className="space-y-1">
                <label className="text-xs font-bold text-m-subtext uppercase ml-1">ğŸ’° Price</label>
                <input type="number" className="w-full bg-m-bg/50 border-2 border-dashed border-m-line/70 rounded-xl p-3 text-sm focus:border-m-primary focus:ring-0 placeholder-m-secondary/50 transition-all" placeholder="$" value={formData.price} onChange={e=>setFormData({...formData, price: e.target.value})} required />
              </div>

              <div>
                <label className="text-xs font-bold text-m-subtext uppercase mb-2 block ml-1">ğŸ§Š Ice / Temp</label>
                <div className="flex flex-wrap gap-2">
                  {ICE_OPTIONS.map(opt => (
                    <button key={opt} type="button" onClick={() => setFormData({...formData, ice: opt})} 
                      className={`text-xs px-3 py-2 rounded-lg border-2 transition-all hover:scale-105 active:scale-95 ${formData.ice === opt ? 'bg-m-text text-white border-m-text font-bold shadow-sm' : 'bg-white border-dashed border-m-line/70 text-m-subtext hover:border-m-secondary'}`}>
                      {opt}
                    </button>
                  ))}
                </div>
              </div>

              <div>
                <label className="text-xs font-bold text-m-subtext uppercase mb-2 block ml-1">ğŸ¬ Sugar</label>
                <div className="flex flex-wrap gap-2">
                  {SUGAR_OPTIONS.map(opt => (
                    <button key={opt} type="button" onClick={() => setFormData({...formData, sugar: opt})} 
                      className={`text-xs px-3 py-2 rounded-lg border-2 transition-all hover:scale-105 active:scale-95 ${formData.sugar === opt ? 'bg-m-accent text-white border-m-accent font-bold shadow-sm' : 'bg-white border-dashed border-m-line/70 text-m-subtext hover:border-m-secondary'}`}>
                      {opt}
                    </button>
                  ))}
                </div>
              </div>

              <button type="submit" className="w-full bg-m-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-m-primary/20 hover:bg-m-primary/90 transition-all mt-6 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
                <span>Add to Diary</span> âœ¨
              </button>
            </form>
          </div>
        </div>
      );
    };

    const StatsView = ({ records }) => {
      const stats = calculateStats(records);
      return (
        <div className="flex-1 overflow-y-auto p-6 space-y-6 bg-white/40 backdrop-blur-sm">
          <h2 className="text-2xl font-serif text-m-text mb-6 flex items-center gap-2">ğŸ“Š Summary</h2>
          
          <div className="grid grid-cols-2 gap-4">
            <div className="bg-white/80 p-5 rounded-2xl shadow-soft flex flex-col justify-between h-32 border border-m-line/30 transition-transform hover:scale-[1.02]">
              <div className="bg-m-bg w-8 h-8 rounded-full flex items-center justify-center text-m-primary shadow-sm"><Icons.Cup size={16}/></div>
              <div>
                <div className="text-3xl font-bold text-m-text">{stats.cups} <span className="text-sm font-normal text-m-subtext">æ¯</span></div>
                <div className="text-xs text-m-subtext">Total Cups</div>
              </div>
            </div>
            <div className="bg-white/80 p-5 rounded-2xl shadow-soft flex flex-col justify-between h-32 border border-m-line/30 transition-transform hover:scale-[1.02]">
              <div className="bg-m-bg w-8 h-8 rounded-full flex items-center justify-center text-m-accent shadow-sm"><span className="font-bold text-xs">$</span></div>
              <div>
                <div className="text-3xl font-bold text-m-text">${stats.cost}</div>
                <div className="text-xs text-m-subtext">Total Spent</div>
              </div>
            </div>
          </div>

          {stats.topShop && (
            <div className="bg-m-text text-m-bg p-5 rounded-2xl shadow-lg relative overflow-hidden transition-transform hover:scale-[1.01]">
              <div className="relative z-10">
                <div className="text-xs opacity-60 uppercase tracking-widest mb-1 flex items-center gap-1">ğŸ† Favorite Shop</div>
                <div className="text-2xl font-bold">{stats.topShop[0]}</div>
                <div className="mt-4 text-sm opacity-80 bg-white/10 inline-block px-2 py-1 rounded-full">Ordered {stats.topShop[1]} times</div>
              </div>
              <div className="absolute -right-4 -bottom-4 opacity-10 rotate-12 transform scale-150">
                <Icons.Cup size={100} />
              </div>
            </div>
          )}
          
          <div className="bg-white/80 p-5 rounded-2xl shadow-soft border border-m-line/30">
            <h3 className="text-sm font-bold text-m-subtext uppercase mb-4 flex items-center gap-1">ğŸ¬ Sugar Preference</h3>
            <div className="space-y-2">
              {Object.entries(stats.sugars).map(([k, v]) => (
                <div key={k} className="flex items-center gap-2 text-xs">
                  <div className="w-12 text-m-subtext text-right">{k}</div>
                  <div className="flex-1 h-2 bg-m-bg rounded-full overflow-hidden ring-1 ring-m-line/30">
                    <div className="h-full bg-m-accent" style={{width: `${(v/stats.cups)*100}%`}}></div>
                  </div>
                  <div className="w-6 text-m-text font-bold">{v}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // --- ä¸» App å…ƒä»¶ ---
    const App = () => {
      // --- ç‹€æ…‹ ---
      const [currentDate, setCurrentDate] = useState(new Date());
      const [selectedDateKey, setSelectedDateKey] = useState(null);
      const [records, setRecords] = useState({});
      const [view, setView] = useState('calendar');
      const [showAddForm, setShowAddForm] = useState(false);

      const [formData, setFormData] = useState({ shop: '', item: '', price: '', ice: 'å¾®å†°', sugar: 'å¾®ç³–' });

      // --- åˆå§‹åŒ– ---
      useEffect(() => {
        const todayKey = formatDateKey(new Date());
        setSelectedDateKey(todayKey);
        
        try {
          const saved = localStorage.getItem('emmaBobaRecords');
          if (saved) setRecords(JSON.parse(saved));
        } catch (e) { console.error(e); }
      }, []);

      useEffect(() => {
        if (Object.keys(records).length > 0) {
          localStorage.setItem('emmaBobaRecords', JSON.stringify(records));
        }
      }, [records]);

      const changeMonth = (offset) => {
        setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + offset, 1));
      };

      const handleAddRecord = (e) => {
        e.preventDefault();
        if (!selectedDateKey) return;
        
        const current = records[selectedDateKey] || [];
        if (current.length >= 2) {
          alert("ä»Šå¤©å·²ç¶“å…©æ¯äº†ï¼è©²å–æ°´å›‰ ğŸ’§");
          return;
        }

        const newRec = { id: Date.now(), ...formData, price: Number(formData.price) || 0 };
        setRecords({ ...records, [selectedDateKey]: [...current, newRec] });
        setFormData({ shop: '', item: '', price: '', ice: 'å¾®å†°', sugar: 'å¾®ç³–' });
        setShowAddForm(false);
      };

      const handleDelete = (id) => {
        const updated = records[selectedDateKey].filter(r => r.id !== id);
        const newRecords = { ...records };
        if (updated.length === 0) delete newRecords[selectedDateKey];
        else newRecords[selectedDateKey] = updated;
        setRecords(newRecords);
      };

      // --- Render ---
      return (
        <React.Fragment>
          <div className="flex-none z-10 shadow-sm relative bg-m-bg/60 backdrop-blur-md">
            {view === 'calendar' && (
              <React.Fragment>
                <MainHeader />
                <CalendarHeader currentDate={currentDate} changeMonth={changeMonth} records={records} />
                <CalendarGrid 
                  currentDate={currentDate} 
                  selectedDateKey={selectedDateKey} 
                  setSelectedDateKey={setSelectedDateKey} 
                  setShowAddForm={setShowAddForm} 
                  records={records} 
                />
              </React.Fragment>
            )}
            {view === 'stats' && (
               <div className="px-6 py-4 flex items-center gap-2">
                 <button onClick={() => setView('calendar')} className="text-m-subtext hover:text-m-text hover:scale-110 active:scale-90 transition-transform"><Icons.Left/></button>
                 <span className="font-bold text-m-text">Back to Calendar</span>
               </div>
            )}
          </div>
          
          {view === 'calendar' ? (
            <RecordList 
              records={records} 
              selectedDateKey={selectedDateKey} 
              handleDelete={handleDelete} 
              setShowAddForm={setShowAddForm} 
            />
          ) : (
            <StatsView records={records} />
          )}
          
          <div className="h-16 bg-white/80 backdrop-blur-md border-t border-m-line/50 flex items-center justify-around px-6 z-20 shrink-0">
            <button onClick={() => setView('calendar')} className={`flex flex-col items-center gap-1 transition-all hover:scale-110 active:scale-95 ${view === 'calendar' ? 'text-m-primary' : 'text-gray-300'}`}>
              <Icons.Calendar size={20} />
              <span className="text-[10px] font-medium">Diary</span>
            </button>
            <button onClick={() => setView('stats')} className={`flex flex-col items-center gap-1 transition-all hover:scale-110 active:scale-95 ${view === 'stats' ? 'text-m-primary' : 'text-gray-300'}`}>
              <Icons.Stats size={20} />
              <span className="text-[10px] font-medium">Stats</span>
            </button>
          </div>

          <AddForm 
            showAddForm={showAddForm} 
            setShowAddForm={setShowAddForm} 
            handleAddRecord={handleAddRecord} 
            formData={formData} 
            setFormData={setFormData} 
          />
        </React.Fragment>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
